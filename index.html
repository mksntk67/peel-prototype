<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Peel Prototype</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #fff;
    touch-action: none;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ===== シール形状（円で代用：最小） ===== */
const sticker = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  r: Math.min(canvas.width, canvas.height) * 0.3,
  peeled: 0, // 0〜1
  broken: false,
  toughness: 0.6, // 硬さ（低いほど破れやすい）
};

/* ヒントポイント（端っこ） */
const hintAngle = Math.random() * Math.PI * 2;
const hint = {
  x: sticker.x + Math.cos(hintAngle) * sticker.r,
  y: sticker.y + Math.sin(hintAngle) * sticker.r,
};

/* 入力状態 */
let dragging = false;
let lastX = 0;
let lastY = 0;
let lastTime = 0;

/* ===== 入力 ===== */
canvas.addEventListener("pointerdown", e => {
  const dx = e.clientX - hint.x;
  const dy = e.clientY - hint.y;
  if (Math.hypot(dx, dy) < 20 && !sticker.broken) {
    dragging = true;
    lastX = e.clientX;
    lastY = e.clientY;
    lastTime = performance.now();
  }
});

canvas.addEventListener("pointermove", e => {
  if (!dragging) return;

  const now = performance.now();
  const dx = e.clientX - lastX;
  const dy = e.clientY - lastY;
  const dt = now - lastTime;

  const speed = Math.hypot(dx, dy) / Math.max(dt, 1);

  /* 力判定（超えると破れる） */
  if (speed > sticker.toughness * 1.2) {
    sticker.broken = true;
    dragging = false;
    return;
  }

  /* ゆっくり剥がすと進む */
  sticker.peeled += speed * 0.05;
  sticker.peeled = Math.min(sticker.peeled, 1);

  lastX = e.clientX;
  lastY = e.clientY;
  lastTime = now;
});

canvas.addEventListener("pointerup", () => dragging = false);
canvas.addEventListener("pointercancel", () => dragging = false);

/* ===== 描画 ===== */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* 下地 */
  ctx.fillStyle = "#d0f0ff";
  ctx.beginPath();
  ctx.arc(sticker.x, sticker.y, sticker.r * sticker.peeled, 0, Math.PI * 2);
  ctx.fill();

  /* シール */
  if (!sticker.broken) {
    ctx.fillStyle = "#ffffff";
    ctx.beginPath();
    ctx.arc(
      sticker.x,
      sticker.y,
      sticker.r,
      -Math.PI * sticker.peeled,
      Math.PI * 2
    );
    ctx.fill();
  }

  /* ヒント */
  if (!sticker.broken && sticker.peeled < 1) {
    ctx.strokeStyle = "#000";
    ctx.beginPath();
    ctx.arc(hint.x, hint.y, 10, 0, Math.PI * 2);
    ctx.stroke();
  }

  /* 失敗表示 */
  if (sticker.broken) {
    ctx.fillStyle = "#000";
    ctx.font = "24px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("やぶれた…", canvas.width / 2, canvas.height / 2);
  }

  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
